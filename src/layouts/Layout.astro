---
export interface Props {
  title: string;
  lang?: string;
  alt?: string;
}

const { title, lang = 'zh-CN', alt = '' } = Astro.props;
const isEn = lang === 'en' || (typeof window !== 'undefined' && window.location.pathname.startsWith('/en/'));
---

<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content="ç¾è‚¡æŠ•èµ„å®æ“æ‰‹å†ŒI - é«˜å€è‚¡åˆ†æä¸ç­–ç•¥å®è·µ" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>
  </head>
  <body>
    <div class="container">
      <!-- å·¦ä¸Šè§’ -->
      <header class="top-nav">
        <div style="display: flex; align-items: center;">
          <button class="sidebar-toggle" id="sidebarToggle" aria-label="åˆ‡æ¢ä¾§è¾¹æ ">ğŸ“š</button>
        </div>
        <div class="right-buttons">
          <button id="toggleReadingMode" class="reading-btn" title="ä¸“æ³¨é˜…è¯»æ¨¡å¼">ğŸ“–</button>
          <button class="theme-toggle" id="themeToggle" aria-label="åˆ‡æ¢ä¸»é¢˜">
            <span class="theme-icon">ğŸŒ™</span>
          </button>
          <button id="decreaseFont" class="font-btn" title="ç¼©å°å­—ä½“">A-</button>
          <button id="increaseFont" class="font-btn" title="æ”¾å¤§å­—ä½“">A+</button>
          <a class="lang-btn" id="langSwitchEn" href={alt} title="English">EN</a>
          <a class="lang-btn" id="langSwitchCn" href={alt} title="ä¸­æ–‡">CN</a>
        </div>
      </header>
      
      <!-- ä¾§è¾¹æ  -->
      <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
          <h2>{isEn ? 'EN Stock Investment Handbook I' : 'ğŸ“ˆ ç¾è‚¡æŠ•èµ„å®æ“æ‰‹å†ŒI'}</h2>
        </div>
        
        <nav class="sidebar-nav">
          <a href={isEn ? '/en/index' : '/'} class="nav-item">
            <span class="chapter-number">ğŸ </span>
            <span class="chapter-title">{isEn ? 'Home' : 'é¦–é¡µ'}</span>
          </a>
          <a href={isEn ? '/en/000_Preface_en' : '/000_åºè¨€'} class="nav-item">
            <span class="chapter-number">ğŸ“–</span>
            <span class="chapter-title">{isEn ? 'Preface' : 'åºè¨€'}</span>
          </a>
          <a href={isEn ? '/en/001_Chapter1_Know_Yourself_and_the_World_en' : '/001_Chapter1_Know_Yourself_and_the_World_CN'} class="nav-item">
            <span class="chapter-number">1ï¸âƒ£</span>
            <span class="chapter-title">{isEn ? 'Chapter 1: Know Yourself & the World' : 'ç¬¬ä¸€ç« ï¼šçœ‹æ¸…è‡ªå·±ï¼Œçœ‹æ‡‚ä¸–ç•Œ'}</span>
          </a>
          <a href={isEn ? '/en/002_Chapter2_Investment_Psychology_and_Risk_Management_en' : '/002_Chapter2_Investment_Psychology_and_Risk_Management_CN'} class="nav-item">
            <span class="chapter-number">2ï¸âƒ£</span>
            <span class="chapter-title">{isEn ? 'Chapter 2: Investment Psychology & Risk Management' : 'ç¬¬äºŒç« ï¼šæŠ•èµ„å¿ƒç†ä¸é£é™©ç®¡ç†'}</span>
          </a>
          <a href={isEn ? '/en/003_Chapter3_Historical_Patterns_and_Multibagger_Stocks_en' : '/003_Chapter3_Historical_Patterns_and_Multibagger_Stocks_CN'} class="nav-item">
            <span class="chapter-number">3ï¸âƒ£</span>
            <span class="chapter-title">{isEn ? 'Chapter 3: Historical Patterns & Multibagger Stocks' : 'ç¬¬ä¸‰ç« ï¼šå†å²è§„å¾‹ä¸é«˜å€è‚¡ç ”ç©¶'}</span>
          </a>
          <a href={isEn ? '/en/004_Chapter4_Track_Selection_and_Industry_Trends_en' : '/004_Chapter4_Track_Selection_and_Industry_Trends_CN'} class="nav-item">
            <span class="chapter-number">4ï¸âƒ£</span>
            <span class="chapter-title">{isEn ? 'Chapter 4: Track Selection & Industry Trends' : 'ç¬¬å››ç« ï¼šèµ›é“é€‰æ‹©ä¸è¡Œä¸šè¶‹åŠ¿'}</span>
          </a>
          <a href={isEn ? '/en/005_Chapter5_Stock_Screening_Strategies_en' : '/005_Chapter5_Stock_Screening_Strategies_CN'} class="nav-item">
            <span class="chapter-number">5ï¸âƒ£</span>
            <span class="chapter-title">{isEn ? 'Chapter 5: Stock Screening Strategies' : 'ç¬¬äº”ç« ï¼šè‚¡ç¥¨ç­›é€‰ç­–ç•¥'}</span>
          </a>
          <a href={isEn ? '/en/006_Chapter6_Trading_Strategies_and_Execution_en' : '/006_Chapter6_Trading_Strategies_and_Execution_CN'} class="nav-item">
            <span class="chapter-number">6ï¸âƒ£</span>
            <span class="chapter-title">{isEn ? 'Chapter 6: Trading Strategies & Execution' : 'ç¬¬å…­ç« ï¼šäº¤æ˜“ç­–ç•¥ä¸æ‰§è¡Œ'}</span>
          </a>
          <a href={isEn ? '/en/007_Chapter7_Investment_Decision_Tools_and_Resources_en' : '/007_Chapter7_Investment_Decision_Tools_and_Resources_CN'} class="nav-item">
            <span class="chapter-number">7ï¸âƒ£</span>
            <span class="chapter-title">{isEn ? 'Chapter 7: Investment Decision Tools & Resources' : 'ç¬¬ä¸ƒç« ï¼šæŠ•èµ„å†³ç­–å·¥å…·ä¸èµ„æº'}</span>
          </a>
          <a href={isEn ? '/en/008_Chapter8_Case_Review_and_Strategy_Improvement_en' : '/008_Chapter8_Case_Review_and_Strategy_Improvement_CN'} class="nav-item">
            <span class="chapter-number">8ï¸âƒ£</span>
            <span class="chapter-title">{isEn ? 'Chapter 8: Case Review & Strategy Improvement' : 'ç¬¬å…«ç« ï¼šæ¡ˆä¾‹å¤ç›˜ä¸ç­–ç•¥æ”¹è¿›'}</span>
          </a>
          <a href={isEn ? '/en/009_Chapter9_Building_an_Investment_System_en' : '/009_Chapter9_Building_Investment_System_CN'} class="nav-item">
            <span class="chapter-number">9ï¸âƒ£</span>
            <span class="chapter-title">{isEn ? 'Chapter 9: Building an Investment System' : 'ç¬¬ä¹ç« ï¼šæ„å»ºæŠ•èµ„ä½“ç³»'}</span>
          </a>
          <a href={isEn ? '/en/010_Chapter10_Trading_Execution_and_Practical_Guide_en' : '/010_Chapter10_Trading_Execution_and_Practical_Guide_CN'} class="nav-item">
            <span class="chapter-number">ğŸ”Ÿ</span>
            <span class="chapter-title">{isEn ? 'Chapter 10: Trading Execution & Practical Guide' : 'ç¬¬åç« ï¼šäº¤æ˜“æ‰§è¡Œä¸å®æˆ˜æŒ‡å—'}</span>
          </a>
          <a href={isEn ? '/en/011_Appendix_en' : '/011_Appendix_CN'} class="nav-item">
            <span class="chapter-number">ğŸ“‹</span>
            <span class="chapter-title">{isEn ? 'Appendix' : 'é™„å½•'}</span>
          </a>
          <a href={isEn ? '/en/012_Strategy_Logic_en' : '/012_Strategy_Logic_CN'} class="nav-item">
            <span class="chapter-number">ğŸ§ </span>
            <span class="chapter-title">{isEn ? 'Strategy Logic' : 'ç­–ç•¥é€»è¾‘'}</span>
          </a>
          <a href={isEn ? '/en/013_Example_Loading_Stock_Price_Data_en' : '/013_Example_Loading_Stock_Price_Data_CN'} class="nav-item">
            <span class="chapter-number">ğŸ“Š</span>
            <span class="chapter-title">{isEn ? 'Example: Loading Stock Price Data' : 'ç¤ºä¾‹ï¼šåŠ è½½è‚¡ç¥¨ä»·æ ¼æ•°æ®'}</span>
          </a>
          <a href={isEn ? '/en/014_Example_Calculating_Momentum_Factor_en' : '/014_Example_Calculating_Momentum_Factor_CN'} class="nav-item">
            <span class="chapter-number">ğŸ“ˆ</span>
            <span class="chapter-title">{isEn ? 'Example: Calculating Momentum Factor' : 'ç¤ºä¾‹ï¼šè®¡ç®—åŠ¨é‡å› å­'}</span>
          </a>
          <a href={isEn ? '/en/015_Example_Building_Equal_Weighted_Portfolio_en' : '/015_Example_Building_Equal_Weighted_Portfolio_CN'} class="nav-item">
            <span class="chapter-number">âš–ï¸</span>
            <span class="chapter-title">{isEn ? 'Example: Building an Equal-Weighted Portfolio' : 'ç¤ºä¾‹ï¼šç­‰æƒæ„å»ºç»„åˆ'}</span>
          </a>
          <a href={isEn ? '/en/016_Example_Backtesting_Return_Curve_en' : '/016_Example_Backtesting_Return_Curve_CN'} class="nav-item">
            <span class="chapter-number">ğŸ“‰</span>
            <span class="chapter-title">{isEn ? 'Example: Backtesting Return Curve' : 'ç¤ºä¾‹ï¼šå›æµ‹æ”¶ç›Šæ›²çº¿'}</span>
          </a>
          <a href={isEn ? '/en/017_Using_scipy_optimize_for_Optimization_en' : '/017_Using_scipy_optimize_for_Optimization_CN'} class="nav-item">
            <span class="chapter-number">ğŸ”§</span>
            <span class="chapter-title">{isEn ? 'Using scipy.optimize for Optimization' : 'ä½¿ç”¨ scipy.optimize è¿›è¡Œä¼˜åŒ–'}</span>
          </a>
        </nav>
      </aside>

      <!-- ä¸»å†…å®¹åŒº -->
      <main class="main-content content-with-sidebar">
        <slot />
      </main>
      <!-- æ–°çš„å›åˆ°é¡¶éƒ¨æŒ‰é’®ï¼Œæ‚¬æµ®åœ¨å³ä¸‹è§’ -->
      <button id="backToTop" class="back-to-top" aria-label="å›åˆ°é¡¶éƒ¨" style="display:none;">â†‘</button>
    </div>

    <style is:global>
      @import '../styles/style.css';
      .top-nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 16px;
        height: 56px;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        background: none !important;
        border: none !important;
        box-shadow: 0 2px 8px rgba(0,0,0,0.04); /* å¯é€‰ï¼Œå¼±é˜´å½±æå‡æ‚¬æµ®æ„Ÿ */
        z-index: 1100;
      }

      .right-buttons {
        display: flex;
        gap: 18px;
        align-items: center;
      }

      .sidebar-toggle,
      .right-buttons button {
        width: 44px;
        height: 44px;
        border-radius: 50%;
        background: var(--primary-color);
        color: white;
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        transition: all 0.3s ease;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }

      .sidebar-toggle:hover,
      .right-buttons button:hover {
        background: var(--primary-dark);
        transform: scale(1.1);
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      }

      @media (max-width: 600px) {
        .right-buttons {
          top: 10px;
          right: 10px;
          gap: 8px;
        }
        .right-buttons button {
          width: 34px;
          height: 34px;
          font-size: 14px;
        }
      }

      /* å­—ä½“æ§åˆ¶æŒ‰é’®æ•´ä½“åŒºåŸŸ */
      .font-controls {
        position: fixed;
        top: 20px;
        right: 110px;
        display: flex;
        gap: 5px;      /* ä¸¤ä¸ªæŒ‰é’®ä¹‹é—´çš„é—´è· */
        z-index: 1000;
      }

      /* å­—ä½“æŒ‰é’®æœ¬èº« */
      .font-controls button {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        /* å…¶ä½™æ ·å¼åŒä¸Š */
      }

      /* ä¸»é¢˜åˆ‡æ¢æŒ‰é’® */
      .theme-control {
        position: fixed;
        top: 20px;
        right: 60px;
        z-index: 1000;
      }

      .bottom-nav {
        display: flex;
        justify-content: flex-start; /* å·¦å¯¹é½ï¼Œæˆ– flex-end å³å¯¹é½ */
        gap: 1.5rem;
        margin-top: 2rem;
        padding-top: 1rem;
        border-top: 1px solid var(--border-color);
      }
    </style>

    <script>
      // ä¾§è¾¹æ åˆ‡æ¢åŠŸèƒ½
      const sidebarToggle = document.getElementById('sidebarToggle');
      const sidebar = document.getElementById('sidebar');
      const mainContent = document.querySelector('.main-content');
      
      sidebarToggle?.addEventListener('click', () => {
        sidebar?.classList.toggle('open');
        mainContent?.classList.toggle('sidebar-open');
      });
      
      // ç‚¹å‡»ä¾§è¾¹æ å¤–éƒ¨å…³é—­ä¾§è¾¹æ 
      document.addEventListener('click', (e) => {
        const target = e.target as Node;
        if (sidebar && sidebarToggle && target &&
            !sidebar.contains(target) && 
            !sidebarToggle.contains(target)) {
          sidebar.classList.remove('open');
          mainContent?.classList.remove('sidebar-open');
        }
      });
      
      // ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½
      const themeToggle = document.getElementById('themeToggle');
      const themeIcon = themeToggle?.querySelector('.theme-icon');
      
      // è·å–ä¿å­˜çš„ä¸»é¢˜æˆ–é»˜è®¤ä½¿ç”¨äº®è‰²ä¸»é¢˜
      const savedTheme = localStorage.getItem('theme') || 'light';
      document.documentElement.setAttribute('data-theme', savedTheme);
      
      // æ›´æ–°å›¾æ ‡
      if (themeIcon) {
        themeIcon.textContent = savedTheme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
      }
      
      // ä¸»é¢˜åˆ‡æ¢äº‹ä»¶
      themeToggle?.addEventListener('click', () => {
        const currentTheme = document.documentElement.getAttribute('data-theme');
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        
        document.documentElement.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
        
        if (themeIcon) {
          themeIcon.textContent = newTheme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
        }
      });
      
      // ä¸“æ³¨é˜…è¯»æ¨¡å¼
      const readingModeBtn = document.getElementById('toggleReadingMode');
      let isFocusMode = localStorage.getItem('focusMode') === 'true';
      
      // åˆå§‹åŒ–ä¸“æ³¨æ¨¡å¼çŠ¶æ€
      if (isFocusMode && readingModeBtn) {
        document.body.classList.add('focus-mode');
        readingModeBtn.textContent = 'ğŸ“š';
        readingModeBtn.title = 'é€€å‡ºä¸“æ³¨æ¨¡å¼';
      }
      
      readingModeBtn?.addEventListener('click', () => {
        document.body.classList.toggle('focus-mode');
        isFocusMode = document.body.classList.contains('focus-mode');
        
        // æ›´æ–°æŒ‰é’®çŠ¶æ€
        if (readingModeBtn) {
          readingModeBtn.textContent = isFocusMode ? 'ğŸ“š' : 'ğŸ“–';
          readingModeBtn.title = isFocusMode ? 'é€€å‡ºä¸“æ³¨æ¨¡å¼' : 'ä¸“æ³¨é˜…è¯»æ¨¡å¼';
        }
        
        // ä¿å­˜çŠ¶æ€åˆ°æœ¬åœ°å­˜å‚¨
        localStorage.setItem('focusMode', isFocusMode.toString());
        
        // ä¸“æ³¨æ¨¡å¼ä¸‹çš„é¢å¤–åŠŸèƒ½
        if (isFocusMode) {
          // éšè—å…¶ä»–æ§åˆ¶æŒ‰é’®
          const sidebarToggle = document.querySelector('.sidebar-toggle');
          const fontControls = document.querySelector('.font-controls');
          const themeControl = document.querySelector('.theme-control');
          
          if (sidebarToggle) {
            sidebarToggle.classList.add('hidden');
          }
          if (fontControls) {
            fontControls.classList.add('hidden');
          }
          if (themeControl) {
            themeControl.classList.add('hidden');
          }
          
          // è‡ªåŠ¨æ»šåŠ¨åˆ°å†…å®¹å¼€å§‹ä½ç½®
          const mainContent = document.querySelector('main');
          if (mainContent) {
            mainContent.scrollIntoView({ behavior: 'smooth' });
          }
          
          // æ·»åŠ é˜…è¯»è¿›åº¦æ¡
          if (!document.querySelector('.reading-progress')) {
            const progressBar = document.createElement('div');
            progressBar.className = 'reading-progress';
            progressBar.innerHTML = '<div class="reading-progress-bar"></div>';
            document.body.appendChild(progressBar);
          }
          
          // æ›´æ–°é˜…è¯»è¿›åº¦
          updateReadingProgress();
        } else {
          // æ˜¾ç¤ºå…¶ä»–æ§åˆ¶æŒ‰é’®
          const sidebarToggle = document.querySelector('.sidebar-toggle');
          const fontControls = document.querySelector('.font-controls');
          const themeControl = document.querySelector('.theme-control');
          
          if (sidebarToggle) {
            sidebarToggle.classList.remove('hidden');
          }
          if (fontControls) {
            fontControls.classList.remove('hidden');
          }
          if (themeControl) {
            themeControl.classList.remove('hidden');
          }
          
          // ç§»é™¤é˜…è¯»è¿›åº¦æ¡
          document.querySelector('.reading-progress')?.remove();
          
          // ç§»é™¤æ»šåŠ¨ç›‘å¬
          window.removeEventListener('scroll', updateReadingProgress);
        }
      });
      
      // æ›´æ–°é˜…è¯»è¿›åº¦å‡½æ•°
      function updateReadingProgress() {
        const progressBar = document.querySelector('.reading-progress-bar');
        if (!progressBar) return;
        
        const scrollTop = window.pageYOffset;
        const docHeight = document.documentElement.scrollHeight - window.innerHeight;
        const scrollPercent = (scrollTop / docHeight) * 100;
        
        (progressBar as any).style.width = scrollPercent + '%';
      }
      
      // åœ¨ä¸“æ³¨æ¨¡å¼ä¸‹ç›‘å¬æ»šåŠ¨
      if (isFocusMode) {
        window.addEventListener('scroll', updateReadingProgress);
      }
      
      // å­—ä½“å¤§å°æ§åˆ¶
      const decreaseFont = document.getElementById('decreaseFont');
      const increaseFont = document.getElementById('increaseFont');
      let fontSize = parseInt(localStorage.getItem('fontSize') || '16', 10);
      document.body.style.fontSize = fontSize + 'px';
      decreaseFont?.addEventListener('click', () => {
        if (fontSize > 12) {
          fontSize -= 2;
          document.body.style.fontSize = fontSize + 'px';
          localStorage.setItem('fontSize', fontSize.toString());
        }
      });
      increaseFont?.addEventListener('click', () => {
        if (fontSize < 24) {
          fontSize += 2;
          document.body.style.fontSize = fontSize + 'px';
          localStorage.setItem('fontSize', fontSize.toString());
        }
      });

      // æ–°å›åˆ°é¡¶éƒ¨æŒ‰é’®é€»è¾‘
      const backToTopBtn = document.getElementById('backToTop');
      if (backToTopBtn) {
        window.addEventListener('scroll', () => {
          if (window.scrollY > 300) {
            backToTopBtn.style.display = 'flex';
          } else {
            backToTopBtn.style.display = 'none';
          }
        });
        backToTopBtn.addEventListener('click', () => {
          window.scrollTo({ top: 0, behavior: 'smooth' });
        });
      }
    </script>
  </body>
</html> 