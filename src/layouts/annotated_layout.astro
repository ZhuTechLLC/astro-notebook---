---
// ç»„ä»¶å±æ€§å®šä¹‰ä¸é»˜è®¤å€¼è®¾ç½®
export interface Props {
  title: string;                // é¡µé¢æ ‡é¢˜
  lang?: string;                // é¡µé¢è¯­è¨€ï¼Œé»˜è®¤ä¸ºä¸­æ–‡
  alt?: string;                 // ä¸­è‹±æ–‡åˆ‡æ¢é“¾æ¥
  currentBook?: string;         // å½“å‰ä¹¦ç±æ ‡è¯†ï¼ˆå¦‚ "theory"ï¼‰
  currentChapter?: string;      // å½“å‰ç« èŠ‚è·¯å¾„
  prevLink?: string;            // ä¸Šä¸€é¡µé“¾æ¥
  prevText?: string;            // ä¸Šä¸€é¡µæŒ‰é’®æ–‡å­—
  nextLink?: string;            // ä¸‹ä¸€é¡µé“¾æ¥
  nextText?: string;            // ä¸‹ä¸€é¡µæŒ‰é’®æ–‡å­—
}

// è§£æ„ Astro.props å¹¶è®¾ç½®é»˜è®¤å€¼
const {
  title,
  lang = 'zh-CN',
  alt = '',
  currentBook = 'theory',
  currentChapter = '',
  prevLink = '/',
  prevText = 'â† è¿”å›',
  nextLink = '',
  nextText = 'ä¸‹ä¸€é¡µ â†’'
} = Astro.props;

// åˆ¤æ–­æ˜¯å¦ä¸ºè‹±æ–‡é¡µé¢ï¼ˆè¯­è¨€è®¾ç½®æˆ–URLå‰ç¼€åˆ¤æ–­ï¼‰
const isEn = lang === 'en' || (typeof window !== 'undefined' && window.location.pathname.startsWith('/en/'));
---

<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content="ç¾è‚¡æŠ•èµ„å®æ“æ‰‹å†Œ - å®Œæ•´çŸ¥è¯†ä½“ç³»" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title> <!-- åŠ¨æ€æ ‡é¢˜ -->
  </head>
  <body>
    <div class="container">
      <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
      <header class="top-nav" id="topNav">
        
        
        <div class="nav-left">
          <!-- åˆ‡æ¢ä¾§è¾¹æ æŒ‰é’® -->
          <button class="sidebar-toggle" id="sidebarToggle" aria-label="åˆ‡æ¢ä¾§è¾¹æ "></button>
        </div>
        <div class="nav-right">
          <!-- ä¸‹ä¸€é¡µé“¾æ¥æŒ‰é’® -->
          {nextLink && <a href={nextLink} class="page-nav-btn next-btn" title={nextText}>{nextText}</a>}
          <!-- ä¸Šä¸€é¡µé“¾æ¥æŒ‰é’® -->
          {prevLink && <a href={prevLink} class="page-nav-btn prev-btn" title={prevText}>{prevText}</a>}
          <!-- ä¸“æ³¨é˜…è¯»æ¨¡å¼æŒ‰é’® -->
          <button id="toggleReadingMode" class="reading-btn" title="ä¸“æ³¨é˜…è¯»æ¨¡å¼">ğŸ“–</button>
          <!-- ä¸»é¢˜åˆ‡æ¢æŒ‰é’® -->
          <button class="theme-toggle" id="themeToggle" aria-label="åˆ‡æ¢ä¸»é¢˜">
            <span class="theme-icon">ğŸŒ™</span>
          </button>ğŸ“š
          <!-- å­—ä½“å¤§å°è°ƒèŠ‚æŒ‰é’® -->
          <button id="decreaseFont" class="font-btn" title="ç¼©å°å­—ä½“">A-</button>
          <button id="increaseFont" class="font-btn" title="æ”¾å¤§å­—ä½“">A+</button>
          <!-- ä¸­è‹±æ–‡åˆ‡æ¢æŒ‰é’® -->
          <a class="lang-btn" id="langSwitchEn" href={alt} title="English">EN</a>
          <a class="lang-btn" id="langSwitchCn" href={alt} title="ä¸­æ–‡">CN</a>
        </div>
      </header>

      <!-- é˜…è¯»è¿›åº¦æ¡ï¼ˆä¸“æ³¨æ¨¡å¼å¯ç”¨ï¼‰ -->
      <div class="reading-progress" id="readingProgress" style="display: none;">
        <div class="reading-progress-bar" id="readingProgressBar"></div>
      </div>

      <!-- ä¾§è¾¹æ  -->
      <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
          <h2 id="sidebarTitle">ğŸ“ˆ ç¾è‚¡æŠ•èµ„å®æ“æ‰‹å†Œ</h2>
        </div>
        <nav class="sidebar-nav" id="sidebarNav">
          <!-- åç»­ç”± JS åŠ¨æ€æ’å…¥ç« èŠ‚å¯¼èˆª -->
        </nav>
      </aside>

      <!-- ä¸»å†…å®¹æ’æ§½åŒºåŸŸ -->
      <main class="main-content" id="mainContent">
        <slot />
      </main>

      <!-- å·¦ä¸‹è§’æµ®åŠ¨å¯¼èˆªæŒ‰é’®åŒº -->
      <div class="left-nav" id="leftNav">
        <!-- è¿”å›é¦–é¡µæŒ‰é’® -->
        <a href="/" class="nav-btn home-btn" title="è¿”å›é¦–é¡µ">
          <span class="nav-icon">ğŸ </span>
          <span class="nav-text">è¿”å›é¦–é¡µ</span>
        </a>
        <!-- è¿”å›ç›®å½•æŒ‰é’® -->
        <a href="#" class="nav-btn toc-btn" id="tocBtn" title="è¿”å›ç›®å½•">
          <span class="nav-icon">ğŸ“š</span>
          <span class="nav-text">è¿”å›ç›®å½•</span>
        </a>
        <!-- æµè§ˆå™¨åé€€æŒ‰é’® -->
        <button class="nav-btn back-btn" id="backBtn" title="ä¸Šä¸€é¡µ">
          <span class="nav-icon">â†</span>
          <span class="nav-text">ä¸Šä¸€é¡µ</span>
        </button>
      </div>

      <!-- ç« èŠ‚ç¿»é¡µæŒ‰é’®åŒºåŸŸï¼ˆä»…ç‰¹å®šé¡µé¢æ˜¾ç¤ºï¼‰ -->
      <div class="chapter-nav" id="chapterNav" style="display: none;">
        <button class="chapter-btn prev-chapter" id="prevChapter" disabled>
          <span class="chapter-icon">â†</span>
          <span class="chapter-text">ä¸Šä¸€ç« </span>
        </button>
        <button class="chapter-btn next-chapter" id="nextChapter">
          <span class="chapter-text">ä¸‹ä¸€ç« </span>
          <span class="chapter-icon">â†’</span>
        </button>
      </div>

      <!-- å›åˆ°é¡¶éƒ¨æŒ‰é’® -->
      <button id="backToTop" class="back-to-top" aria-label="å›åˆ°é¡¶éƒ¨" style="display: none;">â†‘</button>
    </div>
  </body>
</html>