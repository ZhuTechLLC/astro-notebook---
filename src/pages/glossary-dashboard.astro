---
import Layout from '../layouts/Layout.astro';
---

<Layout title="é‡‘èå…³é”®è¯æ•°æ®åº“ç®¡ç†">
  <div class="dashboard-container">
    <header class="dashboard-header">
      <h1>ğŸ“š é‡‘èå…³é”®è¯æ•°æ®åº“ç®¡ç†</h1>
      <p class="header-description">
        è‡ªåŠ¨è¯†åˆ«ã€ç®¡ç†å’Œå±•ç¤ºæŠ•èµ„æ‰‹å†Œä¸­çš„é‡‘èæœ¯è¯­ï¼Œæä¾›æ™ºèƒ½æ‚¬æµ®æç¤ºåŠŸèƒ½
      </p>
    </header>

    <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
    <section class="stats-overview">
      <div class="stat-card">
        <div class="stat-icon">ğŸ“Š</div>
        <div class="stat-content">
          <div class="stat-number" id="totalKeywords">0</div>
          <div class="stat-label">æ€»å…³é”®è¯</div>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon">ğŸ“„</div>
        <div class="stat-content">
          <div class="stat-number" id="processedPages">0</div>
          <div class="stat-label">å·²å¤„ç†é¡µé¢</div>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon">ğŸ·ï¸</div>
        <div class="stat-content">
          <div class="stat-number" id="totalCategories">0</div>
          <div class="stat-label">æœ¯è¯­åˆ†ç±»</div>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon">ğŸ”„</div>
        <div class="stat-content">
          <div class="stat-number" id="lastUpdated">--</div>
          <div class="stat-label">æœ€åæ›´æ–°</div>
        </div>
      </div>
    </section>

    <!-- æ“ä½œé¢æ¿ -->
    <section class="control-panel">
      <div class="panel-group">
        <h3>ğŸ› ï¸ æ•°æ®åº“æ“ä½œ</h3>
        <div class="button-group">
          <button id="refreshStats" class="btn btn-primary">
            <span class="btn-icon">ğŸ”„</span>
            åˆ·æ–°ç»Ÿè®¡
          </button>
          <button id="processAllPages" class="btn btn-secondary">
            <span class="btn-icon">âš¡</span>
            æ‰¹é‡å¤„ç†é¡µé¢
          </button>
          <button id="exportDatabase" class="btn btn-success">
            <span class="btn-icon">ğŸ“¤</span>
            å¯¼å‡ºæ•°æ®åº“
          </button>
          <button id="clearDatabase" class="btn btn-danger">
            <span class="btn-icon">ğŸ—‘ï¸</span>
            æ¸…ç©ºæ•°æ®åº“
          </button>
        </div>
      </div>

      <div class="panel-group">
        <h3>ğŸ” æœç´¢å’Œç­›é€‰</h3>
        <div class="search-controls">
          <input type="text" id="searchInput" placeholder="æœç´¢å…³é”®è¯..." class="search-input">
          <select id="categoryFilter" class="category-select">
            <option value="">æ‰€æœ‰åˆ†ç±»</option>
          </select>
          <button id="searchKeywords" class="btn btn-primary">æœç´¢</button>
        </div>
      </div>
    </section>

    <!-- åˆ†ç±»ç»Ÿè®¡ -->
    <section class="category-stats">
      <h3>ğŸ“Š åˆ†ç±»ç»Ÿè®¡</h3>
      <div id="categoryChart" class="category-chart">
        <div class="loading">åŠ è½½ä¸­...</div>
      </div>
    </section>

    <!-- å…³é”®è¯åˆ—è¡¨ -->
    <section class="keywords-section">
      <div class="section-header">
        <h3>ğŸ“ å…³é”®è¯åˆ—è¡¨</h3>
        <div class="list-controls">
          <select id="sortBy" class="sort-select">
            <option value="keyword">æŒ‰æœ¯è¯­æ’åº</option>
            <option value="category">æŒ‰åˆ†ç±»æ’åº</option>
            <option value="priority">æŒ‰ä¼˜å…ˆçº§æ’åº</option>
            <option value="firstAppearance">æŒ‰é¦–æ¬¡å‡ºç°æ’åº</option>
          </select>
          <button id="toggleView" class="btn btn-outline">
            <span class="btn-icon">ğŸ“‹</span>
            åˆ‡æ¢è§†å›¾
          </button>
        </div>
      </div>
      
      <div id="keywordsList" class="keywords-list">
        <div class="loading">åŠ è½½å…³é”®è¯åˆ—è¡¨...</div>
      </div>
    </section>

    <!-- é¡µé¢å¤„ç†çŠ¶æ€ -->
    <section class="processing-status">
      <h3>ğŸ“„ é¡µé¢å¤„ç†çŠ¶æ€</h3>
      <div id="pagesList" class="pages-list">
        <div class="loading">åŠ è½½é¡µé¢åˆ—è¡¨...</div>
      </div>
    </section>

    <!-- å¯¼å…¥/å¯¼å‡ºé¢æ¿ -->
    <section class="import-export-panel" style="display: none;">
      <h3>ğŸ“ æ•°æ®å¯¼å…¥/å¯¼å‡º</h3>
      <div class="panel-content">
        <div class="import-section">
          <h4>å¯¼å…¥æ•°æ®</h4>
          <input type="file" id="importFile" accept=".json" class="file-input">
          <button id="importDatabase" class="btn btn-primary">å¯¼å…¥æ•°æ®åº“</button>
        </div>
        
        <div class="export-section">
          <h4>å¯¼å‡ºæ•°æ®</h4>
          <textarea id="exportData" readonly class="export-textarea" placeholder="å¯¼å‡ºçš„æ•°æ®å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..."></textarea>
          <button id="copyExportData" class="btn btn-secondary">å¤åˆ¶æ•°æ®</button>
        </div>
      </div>
    </section>
  </div>
</Layout>

<style>
  .dashboard-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 2rem;
  }

  .dashboard-header {
    text-align: center;
    margin-bottom: 3rem;
  }

  .dashboard-header h1 {
    color: var(--primary-color);
    margin-bottom: 1rem;
    font-size: 2.5rem;
  }

  .header-description {
    color: var(--text-secondary);
    font-size: 1.1rem;
    max-width: 600px;
    margin: 0 auto;
    line-height: 1.6;
  }

  /* ç»Ÿè®¡æ¦‚è§ˆ */
  .stats-overview {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-bottom: 3rem;
  }

  .stat-card {
    background: var(--card-bg);
    border: 1px solid var(--border-color);
    border-radius: 12px;
    padding: 2rem;
    display: flex;
    align-items: center;
    gap: 1.5rem;
    transition: transform 0.2s, box-shadow 0.2s;
  }

  .stat-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  .stat-icon {
    font-size: 3rem;
    opacity: 0.8;
  }

  .stat-number {
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--primary-color);
    line-height: 1;
  }

  .stat-label {
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-top: 0.5rem;
  }

  /* æ§åˆ¶é¢æ¿ */
  .control-panel {
    background: var(--card-bg);
    border: 1px solid var(--border-color);
    border-radius: 12px;
    padding: 2rem;
    margin-bottom: 3rem;
  }

  .panel-group {
    margin-bottom: 2rem;
  }

  .panel-group:last-child {
    margin-bottom: 0;
  }

  .panel-group h3 {
    color: var(--primary-color);
    margin-bottom: 1rem;
    font-size: 1.3rem;
  }

  .button-group {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .search-controls {
    display: flex;
    gap: 1rem;
    align-items: center;
    flex-wrap: wrap;
  }

  /* æŒ‰é’®æ ·å¼ */
  .btn {
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.9rem;
  }

  .btn-primary {
    background: var(--primary-color);
    color: white;
  }

  .btn-primary:hover {
    background: var(--primary-dark);
  }

  .btn-secondary {
    background: var(--text-secondary);
    color: white;
  }

  .btn-secondary:hover {
    background: var(--text-primary);
  }

  .btn-success {
    background: #10b981;
    color: white;
  }

  .btn-success:hover {
    background: #059669;
  }

  .btn-danger {
    background: #ef4444;
    color: white;
  }

  .btn-danger:hover {
    background: #dc2626;
  }

  .btn-outline {
    background: transparent;
    color: var(--primary-color);
    border: 1px solid var(--primary-color);
  }

  .btn-outline:hover {
    background: var(--primary-color);
    color: white;
  }

  .btn-icon {
    font-size: 1rem;
  }

  /* è¾“å…¥æ¡†æ ·å¼ */
  .search-input, .category-select, .sort-select {
    padding: 0.75rem 1rem;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    background: var(--bg-primary);
    color: var(--text-primary);
    font-size: 0.9rem;
  }

  .search-input {
    min-width: 300px;
    flex: 1;
  }

  /* åˆ†ç±»ç»Ÿè®¡ */
  .category-stats {
    background: var(--card-bg);
    border: 1px solid var(--border-color);
    border-radius: 12px;
    padding: 2rem;
    margin-bottom: 3rem;
  }

  .category-stats h3 {
    color: var(--primary-color);
    margin-bottom: 1.5rem;
  }

  .category-chart {
    min-height: 200px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* å…³é”®è¯åˆ—è¡¨ */
  .keywords-section {
    background: var(--card-bg);
    border: 1px solid var(--border-color);
    border-radius: 12px;
    padding: 2rem;
    margin-bottom: 3rem;
  }

  .section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
    gap: 1rem;
  }

  .section-header h3 {
    color: var(--primary-color);
    margin: 0;
  }

  .list-controls {
    display: flex;
    gap: 1rem;
    align-items: center;
  }

  .keywords-list {
    min-height: 300px;
  }

  /* é¡µé¢åˆ—è¡¨ */
  .processing-status {
    background: var(--card-bg);
    border: 1px solid var(--border-color);
    border-radius: 12px;
    padding: 2rem;
    margin-bottom: 3rem;
  }

  .processing-status h3 {
    color: var(--primary-color);
    margin-bottom: 1.5rem;
  }

  .pages-list {
    min-height: 200px;
  }

  /* å¯¼å…¥å¯¼å‡ºé¢æ¿ */
  .import-export-panel {
    background: var(--card-bg);
    border: 1px solid var(--border-color);
    border-radius: 12px;
    padding: 2rem;
  }

  .import-export-panel h3 {
    color: var(--primary-color);
    margin-bottom: 1.5rem;
  }

  .panel-content {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 2rem;
  }

  .file-input {
    margin-bottom: 1rem;
    padding: 0.5rem;
    border: 1px solid var(--border-color);
    border-radius: 4px;
    width: 100%;
  }

  .export-textarea {
    width: 100%;
    min-height: 200px;
    padding: 1rem;
    border: 1px solid var(--border-color);
    border-radius: 4px;
    background: var(--bg-primary);
    color: var(--text-primary);
    font-family: monospace;
    font-size: 0.85rem;
    resize: vertical;
    margin-bottom: 1rem;
  }

  /* åŠ è½½çŠ¶æ€ */
  .loading {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 2rem;
    color: var(--text-secondary);
    font-style: italic;
  }

  /* å“åº”å¼è®¾è®¡ */
  @media (max-width: 768px) {
    .dashboard-container {
      padding: 1rem;
    }

    .dashboard-header h1 {
      font-size: 2rem;
    }

    .stats-overview {
      grid-template-columns: 1fr;
    }

    .stat-card {
      padding: 1.5rem;
    }

    .button-group {
      flex-direction: column;
    }

    .search-controls {
      flex-direction: column;
      align-items: stretch;
    }

    .search-input {
      min-width: auto;
    }

    .section-header {
      flex-direction: column;
      align-items: stretch;
    }

    .list-controls {
      justify-content: space-between;
    }

    .panel-content {
      grid-template-columns: 1fr;
    }
  }
</style>

<script>
  // é‡‘èå…³é”®è¯æ•°æ®åº“ç®¡ç†è„šæœ¬
  document.addEventListener('DOMContentLoaded', async function() {
    console.log('ğŸš€ Initializing Glossary Dashboard...');
    
    // åˆå§‹åŒ–é¡µé¢
    await initializeDashboard();
    
    // ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
    bindEventListeners();
    
    console.log('âœ… Glossary Dashboard initialized');
  });

  // åˆå§‹åŒ–ä»ªè¡¨æ¿
  async function initializeDashboard() {
    try {
      await refreshStats();
      await loadCategoryChart();
      await loadKeywordsList();
      await loadPagesList();
    } catch (error) {
      console.error('âŒ Failed to initialize dashboard:', error);
      showError('åˆå§‹åŒ–ä»ªè¡¨æ¿å¤±è´¥: ' + error.message);
    }
  }

  // åˆ·æ–°ç»Ÿè®¡æ•°æ®
  async function refreshStats() {
    try {
      // æ¨¡æ‹Ÿæ•°æ®ï¼ˆå®é™…åº”ç”¨ä¸­åº”è¯¥ä»APIè·å–ï¼‰
      const stats = {
        totalKeywords: 156,
        processedPages: 23,
        totalCategories: 12,
        lastUpdated: new Date().toLocaleString('zh-CN')
      };

      document.getElementById('totalKeywords').textContent = stats.totalKeywords;
      document.getElementById('processedPages').textContent = stats.processedPages;
      document.getElementById('totalCategories').textContent = stats.totalCategories;
      document.getElementById('lastUpdated').textContent = stats.lastUpdated;

      console.log('ğŸ“Š Stats refreshed:', stats);
    } catch (error) {
      console.error('âŒ Failed to refresh stats:', error);
    }
  }

  // åŠ è½½åˆ†ç±»å›¾è¡¨
  async function loadCategoryChart() {
    const chartContainer = document.getElementById('categoryChart');
    
    try {
      // æ¨¡æ‹Ÿåˆ†ç±»æ•°æ®
      const categories = {
        'æŠ•èµ„æ¦‚å¿µ': 25,
        'è´¢åŠ¡æŒ‡æ ‡': 32,
        'æŠ€æœ¯åˆ†æ': 18,
        'é£é™©ç®¡ç†': 15,
        'æŠ•èµ„äº§å“': 22,
        'ç»æµæŒ‡æ ‡': 16,
        'æ–°å…´æŠ€æœ¯': 14,
        'æŠ•èµ„ç­–ç•¥': 14
      };

      chartContainer.innerHTML = createCategoryChart(categories);
    } catch (error) {
      chartContainer.innerHTML = '<div class="error">åŠ è½½åˆ†ç±»ç»Ÿè®¡å¤±è´¥</div>';
      console.error('âŒ Failed to load category chart:', error);
    }
  }

  // åˆ›å»ºåˆ†ç±»å›¾è¡¨HTML
  function createCategoryChart(categories) {
    const total = Object.values(categories).reduce((sum, count) => sum + count, 0);
    
    let html = '<div class="category-bars">';
    
    Object.entries(categories).forEach(([category, count]) => {
      const percentage = ((count / total) * 100).toFixed(1);
      html += `
        <div class="category-bar">
          <div class="category-info">
            <span class="category-name">${category}</span>
            <span class="category-count">${count} (${percentage}%)</span>
          </div>
          <div class="bar-container">
            <div class="bar-fill" style="width: ${percentage}%"></div>
          </div>
        </div>
      `;
    });
    
    html += '</div>';
    
    // æ·»åŠ æ ·å¼
    html += `
      <style>
        .category-bars {
          display: flex;
          flex-direction: column;
          gap: 1rem;
        }
        
        .category-bar {
          display: flex;
          flex-direction: column;
          gap: 0.5rem;
        }
        
        .category-info {
          display: flex;
          justify-content: space-between;
          font-size: 0.9rem;
        }
        
        .category-name {
          font-weight: 600;
          color: var(--text-primary);
        }
        
        .category-count {
          color: var(--text-secondary);
        }
        
        .bar-container {
          height: 8px;
          background: var(--bg-secondary);
          border-radius: 4px;
          overflow: hidden;
        }
        
        .bar-fill {
          height: 100%;
          background: linear-gradient(90deg, var(--primary-color), var(--primary-dark));
          transition: width 0.3s ease;
        }
      </style>
    `;
    
    return html;
  }

  // åŠ è½½å…³é”®è¯åˆ—è¡¨
  async function loadKeywordsList() {
    const listContainer = document.getElementById('keywordsList');
    
    try {
      // æ¨¡æ‹Ÿå…³é”®è¯æ•°æ®
      const keywords = [
        { keyword: 'é«˜å€è‚¡', category: 'æŠ•èµ„æ¦‚å¿µ', priority: 10, pageUrl: '/book1/003_Chapter3/3.1', firstAppearance: '2025-01-08T10:30:00Z' },
        { keyword: 'Ten-bagger', category: 'æŠ•èµ„æ¦‚å¿µ', priority: 9, pageUrl: '/book1/003_Chapter3/3.1', firstAppearance: '2025-01-08T10:31:00Z' },
        { keyword: 'PE', category: 'è´¢åŠ¡æŒ‡æ ‡', priority: 6, pageUrl: '/book1/003_Chapter3/3.1', firstAppearance: '2025-01-08T10:32:00Z' },
        { keyword: 'æŠ¤åŸæ²³', category: 'æŠ•èµ„åˆ†æ', priority: 7, pageUrl: '/book1/003_Chapter3/3.1', firstAppearance: '2025-01-08T10:33:00Z' },
        { keyword: 'å¸‚å€¼', category: 'è´¢åŠ¡æŒ‡æ ‡', priority: 5, pageUrl: '/book1/003_Chapter3/3.1', firstAppearance: '2025-01-08T10:34:00Z' }
      ];

      listContainer.innerHTML = createKeywordsList(keywords);
    } catch (error) {
      listContainer.innerHTML = '<div class="error">åŠ è½½å…³é”®è¯åˆ—è¡¨å¤±è´¥</div>';
      console.error('âŒ Failed to load keywords list:', error);
    }
  }

  // åˆ›å»ºå…³é”®è¯åˆ—è¡¨HTML
  function createKeywordsList(keywords) {
    let html = '<div class="keywords-grid">';
    
    keywords.forEach(keyword => {
      html += `
        <div class="keyword-card" data-category="${keyword.category}" data-priority="${keyword.priority}">
          <div class="keyword-header">
            <span class="keyword-term">${keyword.keyword}</span>
            <span class="keyword-priority">ä¼˜å…ˆçº§: ${keyword.priority}</span>
          </div>
          <div class="keyword-meta">
            <span class="keyword-category">${keyword.category}</span>
            <span class="keyword-page">${keyword.pageUrl}</span>
          </div>
          <div class="keyword-date">
            é¦–æ¬¡å‡ºç°: ${new Date(keyword.firstAppearance).toLocaleString('zh-CN')}
          </div>
        </div>
      `;
    });
    
    html += '</div>';
    
    // æ·»åŠ æ ·å¼
    html += `
      <style>
        .keywords-grid {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
          gap: 1rem;
        }
        
        .keyword-card {
          background: var(--bg-secondary);
          border: 1px solid var(--border-color);
          border-radius: 8px;
          padding: 1rem;
          transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .keyword-card:hover {
          transform: translateY(-2px);
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .keyword-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 0.5rem;
        }
        
        .keyword-term {
          font-weight: 700;
          color: var(--primary-color);
          font-size: 1.1rem;
        }
        
        .keyword-priority {
          background: var(--primary-color);
          color: white;
          padding: 0.2rem 0.5rem;
          border-radius: 4px;
          font-size: 0.8rem;
        }
        
        .keyword-meta {
          display: flex;
          justify-content: space-between;
          margin-bottom: 0.5rem;
        }
        
        .keyword-category {
          background: var(--text-secondary);
          color: white;
          padding: 0.2rem 0.5rem;
          border-radius: 4px;
          font-size: 0.8rem;
        }
        
        .keyword-page {
          font-size: 0.8rem;
          color: var(--text-secondary);
          font-family: monospace;
        }
        
        .keyword-date {
          font-size: 0.75rem;
          color: var(--text-secondary);
          font-style: italic;
        }
      </style>
    `;
    
    return html;
  }

  // åŠ è½½é¡µé¢åˆ—è¡¨
  async function loadPagesList() {
    const listContainer = document.getElementById('pagesList');
    
    try {
      // æ¨¡æ‹Ÿé¡µé¢æ•°æ®
      const pages = [
        { url: '/book1/003_Chapter3/3.1', title: '3.1 é«˜å€è‚¡çš„å®šä¹‰ä¸æ—¶é—´ç»´åº¦', keywordCount: 15, processed: true, lastProcessed: '2025-01-08T10:30:00Z' },
        { url: '/book1/003_Chapter3/3.2', title: '3.2 è¡Œä¸šåˆ†å¸ƒå’Œç‰¹å¾', keywordCount: 12, processed: true, lastProcessed: '2025-01-08T09:15:00Z' },
        { url: '/book1/004_Chapter4/4.1', title: '4.1 èµ›é“ç­›é€‰æ–¹æ³•', keywordCount: 8, processed: false, lastProcessed: null }
      ];

      listContainer.innerHTML = createPagesList(pages);
    } catch (error) {
      listContainer.innerHTML = '<div class="error">åŠ è½½é¡µé¢åˆ—è¡¨å¤±è´¥</div>';
      console.error('âŒ Failed to load pages list:', error);
    }
  }

  // åˆ›å»ºé¡µé¢åˆ—è¡¨HTML
  function createPagesList(pages) {
    let html = '<div class="pages-table">';
    html += `
      <div class="table-header">
        <div class="table-cell">é¡µé¢</div>
        <div class="table-cell">å…³é”®è¯æ•°</div>
        <div class="table-cell">çŠ¶æ€</div>
        <div class="table-cell">æœ€åå¤„ç†</div>
      </div>
    `;
    
    pages.forEach(page => {
      const status = page.processed ? 'å·²å¤„ç†' : 'å¾…å¤„ç†';
      const statusClass = page.processed ? 'status-processed' : 'status-pending';
      const lastProcessed = page.lastProcessed ? 
        new Date(page.lastProcessed).toLocaleString('zh-CN') : 'æœªå¤„ç†';
      
      html += `
        <div class="table-row">
          <div class="table-cell">
            <div class="page-info">
              <div class="page-title">${page.title}</div>
              <div class="page-url">${page.url}</div>
            </div>
          </div>
          <div class="table-cell">
            <span class="keyword-count-badge">${page.keywordCount}</span>
          </div>
          <div class="table-cell">
            <span class="status-badge ${statusClass}">${status}</span>
          </div>
          <div class="table-cell">
            <span class="last-processed">${lastProcessed}</span>
          </div>
        </div>
      `;
    });
    
    html += '</div>';
    
    // æ·»åŠ æ ·å¼
    html += `
      <style>
        .pages-table {
          display: flex;
          flex-direction: column;
        }
        
        .table-header, .table-row {
          display: grid;
          grid-template-columns: 2fr 1fr 1fr 1.5fr;
          gap: 1rem;
          padding: 1rem;
          border-bottom: 1px solid var(--border-color);
        }
        
        .table-header {
          background: var(--bg-secondary);
          font-weight: 600;
          color: var(--text-primary);
        }
        
        .table-row:hover {
          background: var(--bg-secondary);
        }
        
        .table-cell {
          display: flex;
          align-items: center;
        }
        
        .page-info {
          display: flex;
          flex-direction: column;
          gap: 0.2rem;
        }
        
        .page-title {
          font-weight: 600;
          color: var(--text-primary);
        }
        
        .page-url {
          font-size: 0.8rem;
          color: var(--text-secondary);
          font-family: monospace;
        }
        
        .keyword-count-badge {
          background: var(--primary-color);
          color: white;
          padding: 0.3rem 0.6rem;
          border-radius: 12px;
          font-size: 0.8rem;
          font-weight: 600;
        }
        
        .status-badge {
          padding: 0.3rem 0.6rem;
          border-radius: 12px;
          font-size: 0.8rem;
          font-weight: 600;
        }
        
        .status-processed {
          background: #10b981;
          color: white;
        }
        
        .status-pending {
          background: #f59e0b;
          color: white;
        }
        
        .last-processed {
          font-size: 0.8rem;
          color: var(--text-secondary);
        }
      </style>
    `;
    
    return html;
  }

  // ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
  function bindEventListeners() {
    // åˆ·æ–°ç»Ÿè®¡
    document.getElementById('refreshStats').addEventListener('click', refreshStats);
    
    // æ‰¹é‡å¤„ç†é¡µé¢
    document.getElementById('processAllPages').addEventListener('click', processAllPages);
    
    // å¯¼å‡ºæ•°æ®åº“
    document.getElementById('exportDatabase').addEventListener('click', exportDatabase);
    
    // æ¸…ç©ºæ•°æ®åº“
    document.getElementById('clearDatabase').addEventListener('click', clearDatabase);
    
    // æœç´¢å…³é”®è¯
    document.getElementById('searchKeywords').addEventListener('click', searchKeywords);
    
    // åˆ‡æ¢è§†å›¾
    document.getElementById('toggleView').addEventListener('click', toggleView);
  }

  // æ‰¹é‡å¤„ç†é¡µé¢
  async function processAllPages() {
    const button = document.getElementById('processAllPages');
    const originalText = button.innerHTML;
    
    try {
      button.innerHTML = '<span class="btn-icon">â³</span>å¤„ç†ä¸­...';
      button.disabled = true;
      
      // æ¨¡æ‹Ÿå¤„ç†è¿‡ç¨‹
      await new Promise(resolve => setTimeout(resolve, 2000));
      
      showSuccess('æ‰¹é‡å¤„ç†å®Œæˆï¼å¤„ç†äº†23ä¸ªé¡µé¢ï¼Œè¯†åˆ«äº†156ä¸ªé‡‘èå…³é”®è¯ã€‚');
      await refreshStats();
      await loadKeywordsList();
      await loadPagesList();
      
    } catch (error) {
      showError('æ‰¹é‡å¤„ç†å¤±è´¥: ' + error.message);
    } finally {
      button.innerHTML = originalText;
      button.disabled = false;
    }
  }

  // å¯¼å‡ºæ•°æ®åº“
  async function exportDatabase() {
    try {
      const exportData = {
        keywords: {},
        processedPages: [],
        exportDate: new Date().toISOString(),
        totalKeywords: 156
      };
      
      const jsonString = JSON.stringify(exportData, null, 2);
      
      // åˆ›å»ºä¸‹è½½é“¾æ¥
      const blob = new Blob([jsonString], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `glossary-database-${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      
      URL.revokeObjectURL(url);
      showSuccess('æ•°æ®åº“å¯¼å‡ºæˆåŠŸï¼');
      
    } catch (error) {
      showError('å¯¼å‡ºæ•°æ®åº“å¤±è´¥: ' + error.message);
    }
  }

  // æ¸…ç©ºæ•°æ®åº“
  async function clearDatabase() {
    if (!confirm('ç¡®å®šè¦æ¸…ç©ºæ•´ä¸ªé‡‘èå…³é”®è¯æ•°æ®åº“å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼')) {
      return;
    }
    
    try {
      // æ¨¡æ‹Ÿæ¸…ç©ºæ“ä½œ
      await new Promise(resolve => setTimeout(resolve, 1000));
      
      showSuccess('æ•°æ®åº“å·²æ¸…ç©ºï¼');
      await refreshStats();
      await loadKeywordsList();
      await loadPagesList();
      
    } catch (error) {
      showError('æ¸…ç©ºæ•°æ®åº“å¤±è´¥: ' + error.message);
    }
  }

  // æœç´¢å…³é”®è¯
  async function searchKeywords() {
    const query = document.getElementById('searchInput').value.trim();
    const category = document.getElementById('categoryFilter').value;
    
    if (!query && !category) {
      await loadKeywordsList();
      return;
    }
    
    try {
      // æ¨¡æ‹Ÿæœç´¢
      showSuccess(`æœç´¢å®Œæˆï¼æ‰¾åˆ°ç›¸å…³å…³é”®è¯ã€‚`);
      
    } catch (error) {
      showError('æœç´¢å¤±è´¥: ' + error.message);
    }
  }

  // åˆ‡æ¢è§†å›¾
  function toggleView() {
    const listContainer = document.getElementById('keywordsList');
    const currentView = listContainer.dataset.view || 'grid';
    const newView = currentView === 'grid' ? 'list' : 'grid';
    
    listContainer.dataset.view = newView;
    
    const button = document.getElementById('toggleView');
    button.innerHTML = newView === 'grid' ? 
      '<span class="btn-icon">ğŸ“‹</span>åˆ—è¡¨è§†å›¾' : 
      '<span class="btn-icon">ğŸ”²</span>ç½‘æ ¼è§†å›¾';
  }

  // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
  function showSuccess(message) {
    console.log('âœ… ' + message);
    // å¯ä»¥æ·»åŠ toasté€šçŸ¥
  }

  // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
  function showError(message) {
    console.error('âŒ ' + message);
    // å¯ä»¥æ·»åŠ toasté€šçŸ¥
  }
</script> 
 